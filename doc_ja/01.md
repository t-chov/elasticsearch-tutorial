# Elasticsearch 勉強

## 初期構築

- IMDb のデータを用いる
- まずは映画関係者データを持ってきて、検索の基本動作を試す

### やっていること

1. [IMDb Datasets](https://www.imdb.com/interfaces/) からデータを落としてくる
2. gunzip 圧縮されているため、展開しつつ代表作や生年が空のデータを消す
3. [Bulk API](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html) でインデクシング
  * **末尾に `\n` がないとエラーとなるので注意**

## インデクシングできたら

以下のAPIで確認してみる

* [インデックス一覧](http://localhost:9200/_cat/indices?v)
* [黒澤明を出す](http://localhost:9200/imdb_persons/_doc/nm0000041)
* [クロサワで検索](http://localhost:9200/imdb_persons/_search?q=primary_name:kurosawa)

## 検索APIを追ってみる

text: https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html

### Match API

```sh
curl -i -X POST \
   -H "Content-Type:application/json" \
   -d \
'{
  "query": {
    "match": {
      "primary_name": {
        "query": "akira kurosawa",
      }
    }
  }
}' \
 'http://localhost:9200/imdb_persons/_search'
```

これだと `akira OR kurosawa` となるため、ヒット件数がたくさん出る。

```sh
curl -i -X POST \
   -H "Content-Type:application/json" \
   -d \
'{
  "query": {
    "match": {
      "primary_name": {
        "query": "akira kurosawa",
        "operator": "AND"
      }
    }
  }
}' \
 'http://localhost:9200/imdb_persons/_search'
```

こうするのがよい。
